<!DOCTYPE HTML>
<html>
<head>
		<title>Suivre</title>
		<meta name="format-detection" content="telephone=no">
    	<meta name="msapplication-tap-highlight" content="no">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		
 

		<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" />
		<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css" />
		<link rel="stylesheet" href="vendor/waves/waves.min.css" />
		<link rel="stylesheet" href="vendor/wow/animate.css" />
		<link rel="stylesheet" href="css/nativedroid2.css" />


    	 <script>
		      var userAgent = navigator.userAgent + '';
		      if (userAgent.indexOf('iPhone') > -1) {
		        document.write('<script src="js/cordova-iphone.js"></sc' + 'ript>');
		        var mobile_system = 'iphone';
		      } else if (userAgent.indexOf('Android') > -1) {
		        document.write('<script src="js/cordova-android.js"></sc' + 'ript>');
		        var mobile_system = 'android';
		      } else {
		        var mobile_system = '';
		      }
   		 </script>

     
    <style>
					/* Prevent FOUC */
					body { opacity: 0; }
				</style>
	</head>

	<body onload="getValues()">

		<div data-role="page">

			<nd2-include data-src="panel.left.html"></nd2-include>

			<div data-role="panel" id="bottomsheet" data-animate="false" data-position='bottom' data-display="overlay">
				<nd2-include data-src="bottom.sheet.html"></nd2-include>
			</div>

			<div data-role="header" data-position="fixed" >

				<a href="#bottomsheet" class="ui-btn ui-btn-right wow fadeIn" data-wow-delay='1.2s'><i class="zmdi zmdi-more-vert"></i></a>
				<a href="#leftpanel" class="ui-btn ui-btn-left wow fadeIn" data-wow-delay='0.1s'><i class="zmdi zmdi-menu"></i></a>
				<h1 class="wow fadeIn" data-wow-delay='0.4s'>Suivre</h1>

			</div>
			<a href="#" class="ui-btn ui-btn-top ui-btn-icon-left ui-mini ui-btn-raised clr-warning"><i class='zmdi zmdi-alert-circle-o'></i> alert security</a>
			<!-- <div>
				<a href="#" class="ui-btn ui-btn-icon-left ui-mini ui-btn-raised clr-warning"><i class='zmdi zmdi-alert-circle-o'></i> alert security</a>
			<a href="#" class="ui-btn ui-btn-inline ui-btn-fab ui-mini ui-btn-raised ui-btn-icon-left clr-warning"><i class='zmdi zmdi-alert-circle-o zmd-2x'></i>alert security</a>
			</div> -->
			<div role="main" class="ui-content wow fadeIn" data-wow-delay="0.2s"  data-inset="false">

				<div class="nd2-card">
					<div class="card-title has-avatar">
						<h3 class="card-primary-title" id="devices">
					</h3>
						<h5 class="card-subtitle row" ><p class="col s6">Current Location: </p><p class="col s6" id="locations"></p></h5>
						
					</div>
					<div class="card-media" id="deviceimg">
						<!-- <img src="img/laptop.jpg"> -->
					</div>

					<div class="card-supporting-text">
						<ul data-role="listview" data-icon="false" id="listlocations">
				<li data-role="list-divider">
					Track device
				</li>
				<li>
					<a href="#">
						<img src="img/green.jpg" class="ui-thumbnail ui-thumbnail-circular" />
						<h2><i class="zmdi zmdi-pin zmd-1x clr-red"></i>Library</h2>
						<p>12:00pm</p>
					</a>
				</li>
				<li>
					<a href="#">
						<img src="img/green.jpg" class="ui-thumbnail ui-thumbnail-circular" />
						<h2><i class="zmdi zmdi-pin zmd-1x clr-red"></i>Akonor Cafetaria</h2>
						<p>14:45pm</p>
					</a>
				</li>
				<li>
					<a href="#">
						<img src="img/green.jpg" class="ui-thumbnail ui-thumbnail-circular" />
						<h2><i class="zmdi zmdi-pin zmd-1x clr-red"></i>Hostel</h2>
						<p>16:09pm</p>
					</a>
				</li>
			</ul>
					</div>

				</div>
				


			</div>

		</div>
		<script>

		function getValues(){
		
		        var name=getQueryVariable("image");
		        var image = name.replace("%20", " ");
		        

		        var name=getQueryVariable("name");
		        var device = name.replace("%20", " ");
		        
		        
		        var name=getQueryVariable("locationid");
		        var location = name.replace("%20", " ");

		        var name=getQueryVariable("deviceid");
		        var deviceid=name.replace("%20"," ");

	

		        deviceimg.innerHTML="<img src='"+image+"'>";
		       	// locations.innerHTML=location;
		       	devices.innerHTML=device;

		       	var ajaxPageUrl="http://35.166.18.143/~efua.bainson/ajaxPage.php?cmd=10&device="+deviceid;
		  
		      $.ajax(ajaxPageUrl,{
		        async:true,
		        complete:getDeviceLocationsComplete
		      });
		     

   		 }

   		 function getDeviceLocationsComplete(xhr,status){
                if(status!="success"){
                  alert("Error during login");
                  return;
                }
                else{
                  var obj=JSON.parse(xhr.responseText);
                 
                  if(obj.result==0){
                    alert(obj.message);
                  }
                  else{
                     var result="";
                      var length=obj.devicelocation.length;
                      
                      while(length>0){
                      
                        result+="<li ><div class='row' ><img src='"+obj.devicelocation[length-1].image+"' height='80' width='80' class='ui-thumbnail ui-thumbnail-circular col s4' /><div class='col s8'><h4><i class='zmdi zmdi-pin zmd-1x clr-red'></i>"+obj.devicelocation[length-1].placename+"</h4><p>"+obj.devicelocation[length-1].time+"</p></div></div></li>"; 
                        var location=obj.devicelocation[length-1].placename;
                       length-=1;
                     }
               	
                    document.getElementById("listlocations").innerHTML = result;     
                    document.getElementById("locations").innerHTML = " "+location;   
                  
                }
              }
            }
          

        function getQueryVariable(variable) {
        
          var query = window.location.search.substring(1);
          var vars = query.split("&");
          for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
               
              return pair[1];
            }
          } 
          alert('Query Variable ' + variable + ' not found');
        }


		</script>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>
		<script src="vendor/waves/waves.min.js"></script>
		<script src="vendor/wow/wow.min.js"></script>
		<script src="js/nativedroid2.js"></script>
		<script src="nd2settings.js"></script>

	</body>
</html>
